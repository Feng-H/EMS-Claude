# EMS 开发工作流程

## 📋 环境说明

| 环境 | 地址 | 说明 | 用途 |
|------|------|------|------|
| **开发环境** | http://localhost:5173 | Vite 开发服务器 | 日常开发、测试 |
| **生产环境** | http://localhost | Nginx + Docker | 正式部署、演示 |

## 🚀 快速开始

### 1️⃣ 启动开发环境

```bash
./start-dev.sh
```

**优点**：
- ✅ 修改代码立即生效（热更新）
- ✅ 支持调试和错误提示
- ✅ 无需重新构建

**适用场景**：
- 日常开发
- 功能测试
- 问题调试

### 2️⃣ 同步到生产环境

```bash
./sync-to-prod.sh
```

**执行步骤**：
1. 停止开发环境
2. 构建前端生产版本
3. 部署到 Docker 容器
4. 启动生产环境

**适用场景**：
- 功能开发完成
- 需要演示或展示
- 测试生产环境性能

### 3️⃣ 返回开发环境

```bash
./switch-to-dev.sh
```

**执行步骤**：
1. 停止生产环境（Docker）
2. 启动开发环境

**适用场景**：
- 从生产环境返回开发
- 继续开发新功能

## 🔄 典型工作流程

### 场景 1: 日常开发

```bash
# 1. 启动开发环境
./start-dev.sh

# 2. 访问 http://localhost:5173

# 3. 修改代码，自动热更新

# 4. 完成开发后，如需同步到生产环境
./sync-to-prod.sh
```

### 场景 2: 演示/展示

```bash
# 确保所有修改已同步到生产环境
./sync-to-prod.sh

# 访问 http://localhost (80端口)
# 更正式的地址，适合演示
```

### 场景 3: 持续迭代

```bash
# 开发阶段
./start-dev.sh
# ... 开发和测试 ...

# 需要演示或部署
./sync-to-prod.sh

# 演示完后继续开发
./switch-to-dev.sh
# ... 继续开发 ...
```

## 📝 注意事项

### ⚠️ 代码同步

- **开发环境**：直接运行源代码，修改立即生效
- **生产环境**：运行构建后的文件，**需要重新构建才能更新**

### 🔄 什么时候需要同步？

修改以下内容后需要运行 `./sync-to-prod.sh`：

- ✅ Vue 组件文件
- ✅ 样式文件 (CSS/SCSS)
- ✅ 路由配置
- ✅ 静态资源

修改以下内容需要重新构建 **后端**：

- ✅ Go 代码
- ✅ API 接口
- ✅ 数据库结构

### 📦 文件说明

| 脚本 | 说明 |
|------|------|
| `start-dev.sh` | 启动开发环境 |
| `stop-dev.sh` | 停止开发环境 |
| `sync-to-prod.sh` | 同步代码到生产环境 |
| `switch-to-dev.sh` | 从生产环境切回开发环境 |
| `deploy/deploy.sh` | 仅部署生产环境（不构建） |

## 🛠️ 故障排查

### 开发环境无法启动

```bash
# 检查端口占用
lsof -i :5173
lsof -i :8080

# 强制停止所有服务
./stop-dev.sh
docker-compose -f deploy/docker-compose.yml down

# 重新启动
./start-dev.sh
```

### 生产环境无法访问

```bash
# 检查 Docker 容器
docker ps

# 查看容器日志
docker-compose -f deploy/docker-compose.yml logs -f

# 重启生产环境
docker-compose -f deploy/docker-compose.yml restart
```

### 端口冲突

```bash
# 80 端口被占用
sudo lsof -i :80
# 停止占用 80 端口的服务

# 或修改 docker-compose.yml 中的端口映射
# ports:
#   - "8080:80"  # 改用 8080 端口
```

## 📚 更多文档

- [生产环境部署指南](./deploy/README.md)
- [数据库迁移指南](./db/migrations/README.md)
- [项目总览](./CLAUDE.md)

## 💡 最佳实践

1. **开发时**：始终使用开发环境 (localhost:5173)
2. **测试时**：使用开发环境，方便调试
3. **演示时**：使用生产环境 (localhost)，更正式
4. **部署前**：先在开发环境充分测试
5. **定期同步**：完成功能后及时同步到生产环境

## ❓ 常见问题

**Q: 为什么开发环境是 5173 端口，生产环境是 80 端口？**

A:
- 5173 是 Vite 开发服务器的默认端口
- 80 是 HTTP 协议的默认端口，更正式
- 避免端口冲突，开发生产分离

**Q: 修改代码后，生产环境多久能更新？**

A: 不会自动更新，需要运行 `./sync-to-prod.sh` 手动同步

**Q: 可以同时运行开发环境和生产环境吗？**

A: 不建议，因为：
1. 可能端口冲突
2. 资源浪费
3. 容易混淆

**Q: 如何确认当前是哪个环境？**

A:
- 开发环境：访问 localhost:5173
- 生产环境：访问 localhost (80端口)
- 或检查进程：`lsof -i :5173` / `docker ps`
